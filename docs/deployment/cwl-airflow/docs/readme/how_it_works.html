<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How it works &mdash; NSAPH Data Platform 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx_paramlinks.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> NSAPH Data Platform
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">NSAPH Data Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Guide.html">CWL-Airflow Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Howto.html">Howto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Configuration.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Testing.html">Testing the installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Glossary.html">Glossary and FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/UsefulCommands.html">Some useful commands:</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NSAPH Data Platform</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>How it works</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/cwl-airflow/docs/readme/how_it_works.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-it-works">
<h1>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline"></a></h1>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline"></a></h2>
<ol>
<li><p><strong>CWL descriptor file (aka pipeline or workflow)</strong> - YAML or JSON file or its parsed content that complies with <strong><a class="reference external" href="https://www.commonwl.org/v1.1/">CWL v1.1</a></strong> specification and describes inputs, outputs and sequence of steps to be executed.</p></li>
<li><p><strong>Job file (aka job or running configuration)</strong> - YAML or JSON file or its parsed content that is used for initializing workflow inputs with values. Job can optionally include 2 additional fields:</p>
<ul class="simple">
<li><p><strong>tmp_folder</strong> - folder to keep temporary data that will be removed after successful workflow execution</p></li>
<li><p><strong>outputs_folder</strong> - folder to move generated results after successful workflow execution</p></li>
</ul>
<p>If any of the abovementioned parameters was not set the default value will be derived from <code class="docutils literal notranslate"><span class="pre">[cwl]</span></code> section of <strong>airflow.cfg</strong>. For additional details refer to <a class="reference internal" href="how_to_use.html"><span class="doc">Updating airflow.cfg</span></a> section.</p>
</li>
<li><p><strong>DAG</strong> - directed acyclic graph that describes workflow structure.</p></li>
</ol>
<p><strong>Note</strong>, for better understanding of CWL specification and its basic principles, please, refer to the official <a class="reference external" href="http://www.commonwl.org/user_guide/">CWL User Guide</a>.</p>
</section>
<section id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline"></a></h2>
<p>The CWL-airflow package extends Airflow’s functionality with the ability to parse and execute workflows written with the CWL v1.1 specification. We defined 4 basic components — CWLJobDispatcher, CWLStepOperator, CWLJobCleanup, and CWLDAG. The latter is a class for combining the tasks into a DAG that reflects the CWL workflow structure. Every CWLStepOperator task corresponds to a workflow step and depends on others on the basis of the workflow step inputs and outputs. CWLJobDisptacher is used to provide the pipeline with the input data. CWLJobCleanup returns the calculated results to the output folder. Every new CWL workflow results in creation of a new CWLDAG. If the new job is run with the same pipeline, it will not create a new CWLDAG, but run the old one.</p>
<p>Previously, in order to execute CWLDAG a file describing workflow-specific input parameters in JSON or YAML format should have been placed in the special jobs folder. In the current version we removed the necessity for the jobs folder, as the new CWLDAGs can be easily triggered with the required input parameters through the REST API, Airflow UI or command line interface. In case someone needs to monitor a special folder for the new job files added, it can be easily implemented as a separate standard for Airflow DAG.</p>
<p><img alt="../../../_images/scheme.jpg" src="../../../_images/scheme.jpg" /></p>
<p>To add a new workflow, one should simply write a small python script (see example below) and place it into the DAGs folder. Only two parameters are required to initialize a new CWLDAG: path to the <strong>workflow</strong> file and <strong>dag_id</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">cwl_airflow.extensions.cwldag</span> <span class="kn">import</span> <span class="n">CWLDAG</span>
<span class="n">dag</span> <span class="o">=</span> <span class="n">CWLDAG</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="s2">&quot;my_awesome_workflow.cwl&quot;</span><span class="p">,</span> <span class="n">dag_id</span><span class="o">=</span><span class="s2">&quot;my_awesome_dag&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are only three functions that our CWLDAG is responsible for. First – to parse CWL file. Second – to validate CWL syntax. Third – to create a DAG, that will have the same structure as our workflow.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Harvard University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>