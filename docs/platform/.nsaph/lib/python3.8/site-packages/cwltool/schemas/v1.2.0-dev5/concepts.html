
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>References to other specifications &#8212; NSAPH Data Platform 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/sphinx_paramlinks.css" />
    <script data-url_root="../../../../../../../" id="documentation_options" src="../../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="references-to-other-specifications">
<h1>References to other specifications<a class="headerlink" href="#references-to-other-specifications" title="Permalink to this headline">¶</a></h1>
<p><strong>Javascript Object Notation (JSON)</strong>: http://json.org</p>
<p><strong>JSON Linked Data (JSON-LD)</strong>: http://json-ld.org</p>
<p><strong>YAML</strong>: http://yaml.org</p>
<p><strong>Avro</strong>: https://avro.apache.org/docs/1.8.1/spec.html</p>
<p><strong>Uniform Resource Identifier (URI) Generic Syntax</strong>: https://tools.ietf.org/html/rfc3986)</p>
<p><strong>Internationalized Resource Identifiers (IRIs)</strong>:
https://tools.ietf.org/html/rfc3987</p>
<p><strong>Portable Operating System Interface (POSIX.1-2008)</strong>: http://pubs.opengroup.org/onlinepubs/9699919799/</p>
<p><strong>Resource Description Framework (RDF)</strong>: http://www.w3.org/RDF/</p>
<p><strong>XDG Base Directory Specification</strong>: https://specifications.freedesktop.org/basedir-spec/basedir-spec-0.6.html</p>
</div>
<div class="section" id="scope">
<h1>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h1>
<p>This document describes CWL syntax, execution, and object model.  It
is not intended to document a CWL specific implementation, however it may
serve as a reference for the behavior of conforming implementations.</p>
</div>
<div class="section" id="terminology">
<h1>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h1>
<p>The terminology used to describe CWL documents is defined in the
Concepts section of the specification. The terms defined in the
following list are used in building those definitions and in describing the
actions of a CWL implementation:</p>
<p><strong>may</strong>: Conforming CWL documents and CWL implementations are permitted but
not required to behave as described.</p>
<p><strong>must</strong>: Conforming CWL documents and CWL implementations are required to behave
as described; otherwise they are in error.</p>
<p><strong>error</strong>: A violation of the rules of this specification; results are
undefined. Conforming implementations may detect and report an error and may
recover from it.</p>
<p><strong>fatal error</strong>: A violation of the rules of this specification; results are
undefined. Conforming implementations must not continue to execute the current
process and may report an error.</p>
<p><strong>at user option</strong>: Conforming software may or must (depending on the modal verb in
the sentence) behave as described; if it does, it must provide users a means to
enable or disable the behavior described.</p>
<p><strong>deprecated</strong>: Conforming software may implement a behavior for backwards
compatibility.  Portable CWL documents should not rely on deprecated behavior.
Behavior marked as deprecated may be removed entirely from future revisions of
the CWL specification.</p>
</div>
<div class="section" id="data-model">
<h1>Data model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-concepts">
<h2>Data concepts<a class="headerlink" href="#data-concepts" title="Permalink to this headline">¶</a></h2>
<p>An <strong>object</strong> is a data structure equivalent to the “object” type in JSON,
consisting of a unordered set of name/value pairs (referred to here as
<strong>fields</strong>) and where the name is a string and the value is a string, number,
boolean, array, or object.</p>
<p>A <strong>document</strong> is a file containing a serialized object, or an array of objects.</p>
<p>A <strong>process</strong> is a basic unit of computation which accepts input data,
performs some computation, and produces output data. Examples include
CommandLineTools, Workflows, and ExpressionTools.</p>
<p>An <strong>input object</strong> is an object describing the inputs to an
invocation of a process.  The fields of the input object are referred
to as “input parameters”.</p>
<p>An <strong>output object</strong> is an object describing the output resulting from
an invocation of a process.  The fields of the output object are
referred to as “output parameters”.</p>
<p>An <strong>input schema</strong> describes the valid format (required fields, data types)
for an input object.</p>
<p>An <strong>output schema</strong> describes the valid format for an output object.</p>
<p><strong>Metadata</strong> is information about workflows, tools, or input items.</p>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>CWL documents must consist of an object or array of objects represented using
JSON or YAML syntax.  Upon loading, a CWL implementation must apply the
preprocessing steps described in the
<a class="reference external" href="SchemaSalad.html">Semantic Annotations for Linked Avro Data (SALAD) Specification</a>.
An implementation may formally validate the structure of a CWL document using
SALAD schemas located at https://github.com/common-workflow-language/cwl-v1.2/</p>
<p>CWL documents commonly reference other CWL documents.  Each document
must declare the <code class="docutils literal notranslate"><span class="pre">cwlVersion</span></code> of that document.  Implementations must
validate against the document’s declared version.  Implementations
should allow workflows to reference documents of both newer and older
CWL versions (up to the highest version of CWL supported by that
implementation).  Where the runtime enviroment or runtime behavior has
changed between versions, for that portion of the execution an
implementation must provide runtime enviroment and behavior consistent
with the document’s declared version.  An implementation must not
expose a newer feature when executing a document that specifies an
older version that does not not include that feature.</p>
<div class="section" id="map">
<h3>map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<p>Note: This section is non-normative.</p>
<blockquote>
<div><p>type: array&lt;ComplexType&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">key_field</span></code>, ComplexType&gt;</p>
</div></blockquote>
<p>The above syntax in the CWL specifications means there are two or more ways to write the given value.</p>
<p>Option one is a array and is the most verbose option.</p>
<p>Option one generic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_cwl_field</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">key_field</span><span class="p">:</span> <span class="n">a_complex_type1</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">foo</span>
    <span class="n">field3</span><span class="p">:</span> <span class="n">bar</span>
  <span class="o">-</span> <span class="n">key_field</span><span class="p">:</span> <span class="n">a_complex_type2</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">foo2</span>
    <span class="n">field3</span><span class="p">:</span> <span class="n">bar2</span>
  <span class="o">-</span> <span class="n">key_field</span><span class="p">:</span> <span class="n">a_complex_type3</span>
</pre></div>
</div>
<p>Option one specific example using <a class="reference external" href="Workflow.html#Workflow">Workflow</a>.<a class="reference external" href="Workflow.html#WorkflowInputParameter">inputs</a>:</p>
<blockquote>
<div><p>array&lt;InputParameter&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> | InputParameter&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span><span class="p">:</span>
  <span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="n">workflow_input01</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">string</span>
  <span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="n">workflow_input02</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">File</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">edamontology</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">format_2572</span>
</pre></div>
</div>
<p>Option two is enabled by the <code class="docutils literal notranslate"><span class="pre">map&lt;…&gt;</span></code> syntax. Instead of an array of entries we
use a mapping, where one field of the <code class="docutils literal notranslate"><span class="pre">ComplexType</span></code> (here named <code class="docutils literal notranslate"><span class="pre">key_field</span></code>)
becomes the key in the map, and its value is the rest of the <code class="docutils literal notranslate"><span class="pre">ComplexType</span></code>
without the key field. If all of the other fields of the <code class="docutils literal notranslate"><span class="pre">ComplexType</span></code> are
optional and unneeded, then we can indicate this with an empty mapping as the
value: <code class="docutils literal notranslate"><span class="pre">a_complex_type3:</span> <span class="pre">{}</span></code></p>
<p>Option two generic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_cwl_field</span><span class="p">:</span>
  <span class="n">a_complex_type1</span><span class="p">:</span>  <span class="c1"># this was the &quot;key_field&quot; from above</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">foo</span>
    <span class="n">field3</span><span class="p">:</span> <span class="n">bar</span>
  <span class="n">a_complex_type2</span><span class="p">:</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">foo2</span>
    <span class="n">field3</span><span class="p">:</span> <span class="n">bar2</span>
  <span class="n">a_complex_type3</span><span class="p">:</span> <span class="p">{}</span>  <span class="c1"># we accept the defualt values for &quot;field2&quot; and &quot;field3&quot;</span>
</pre></div>
</div>
<p>Option two specific example using <a class="reference external" href="Workflow.html#Workflow">Workflow</a>.<a class="reference external" href="Workflow.html#WorkflowInputParameter">inputs</a>:</p>
<blockquote>
<div><p>array&lt;InputParameter&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> | InputParameter&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span><span class="p">:</span>
  <span class="n">workflow_input01</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">string</span>
  <span class="n">workflow_input02</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">File</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">edamontology</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">format_2572</span>
</pre></div>
</div>
<p>Option two specific example using <a class="reference external" href="#SoftwareRequirement">SoftwareRequirement</a>.<a class="reference external" href="#SoftwarePackage">packages</a>:</p>
<blockquote>
<div><p>array&lt;SoftwarePackage&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">package</span></code>, <code class="docutils literal notranslate"><span class="pre">specs</span></code> | SoftwarePackage&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hints</span><span class="p">:</span>
  <span class="n">SoftwareRequirement</span><span class="p">:</span>
    <span class="n">packages</span><span class="p">:</span>
      <span class="n">sourmash</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">:</span> <span class="p">[</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.21105</span><span class="o">/</span><span class="n">joss</span><span class="o">.</span><span class="mi">00027</span> <span class="p">]</span>
      <span class="n">screed</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">]</span>
      <span class="n">python</span><span class="p">:</span> <span class="p">{}</span>
</pre></div>
</div>
<p>`
Sometimes we have a third and even more compact option denoted like this:</p>
<blockquote>
<div><p>type: array&lt;ComplexType&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">key_field</span></code>, <code class="docutils literal notranslate"><span class="pre">field2</span></code> | ComplexType&gt;</p>
</div></blockquote>
<p>For this example, if we only need the <code class="docutils literal notranslate"><span class="pre">key_field</span></code> and <code class="docutils literal notranslate"><span class="pre">field2</span></code> when specifying
our <code class="docutils literal notranslate"><span class="pre">ComplexType</span></code>s (because the other fields are optional and we are fine with
their default values) then we can abbreviate.</p>
<p>Option three generic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_cwl_field</span><span class="p">:</span>
  <span class="n">a_complex_type1</span><span class="p">:</span> <span class="n">foo</span>   <span class="c1"># we accept the default value for field3</span>
  <span class="n">a_complex_type2</span><span class="p">:</span> <span class="n">foo2</span>  <span class="c1"># we accept the default value for field3</span>
  <span class="n">a_complex_type3</span><span class="p">:</span> <span class="p">{}</span>    <span class="c1"># we accept the default values for &quot;field2&quot; and &quot;field3&quot;</span>
</pre></div>
</div>
<p>Option three specific example using <a class="reference external" href="Workflow.html#Workflow">Workflow</a>.<a class="reference external" href="Workflow.html#WorkflowInputParameter">inputs</a>:</p>
<blockquote>
<div><p>array&lt;InputParameter&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> | InputParameter&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span><span class="p">:</span>
  <span class="n">workflow_input01</span><span class="p">:</span> <span class="n">string</span>
  <span class="n">workflow_input02</span><span class="p">:</span> <span class="n">File</span>  <span class="c1"># we accept the default of no File format</span>
</pre></div>
</div>
<p>Option three specific example using <a class="reference external" href="#SoftwareRequirement">SoftwareRequirement</a>.<a class="reference external" href="#SoftwarePackage">packages</a>:</p>
<blockquote>
<div><p>array&lt;SoftwarePackage&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">package</span></code>, <code class="docutils literal notranslate"><span class="pre">specs</span></code> | SoftwarePackage&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hints</span><span class="p">:</span>
  <span class="n">SoftwareRequirement</span><span class="p">:</span>
    <span class="n">packages</span><span class="p">:</span>
      <span class="n">sourmash</span><span class="p">:</span> <span class="p">[</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.21105</span><span class="o">/</span><span class="n">joss</span><span class="o">.</span><span class="mi">00027</span> <span class="p">]</span>
      <span class="n">python</span><span class="p">:</span> <span class="p">{}</span>
</pre></div>
</div>
<p>What if some entries we want to mix the option 2 and 3? You can!</p>
<p>Mixed option 2 and 3 generic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_cwl_field</span><span class="p">:</span>
  <span class="n">my_complex_type1</span><span class="p">:</span> <span class="n">foo</span>   <span class="c1"># we accept the default value for field3</span>
  <span class="n">my_complex_type2</span><span class="p">:</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">foo2</span>
    <span class="n">field3</span><span class="p">:</span> <span class="n">bar2</span>          <span class="c1"># we did not accept the default value for field3</span>
                          <span class="c1"># so we had to use the slightly expanded syntax</span>
  <span class="n">my_complex_type3</span><span class="p">:</span> <span class="p">{}</span>    <span class="c1"># as before, we accept the default values for both</span>
                          <span class="c1"># &quot;field2&quot; and &quot;field3&quot;</span>
</pre></div>
</div>
<p>Mixed option 2 and 3 specific example using <a class="reference external" href="Workflow.html#Workflow">Workflow</a>.<a class="reference external" href="Workflow.html#WorkflowInputParameter">inputs</a>:</p>
<blockquote>
<div><p>array&lt;InputParameter&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> | InputParameter&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span><span class="p">:</span>
  <span class="n">workflow_input01</span><span class="p">:</span> <span class="n">string</span>
  <span class="n">workflow_input02</span><span class="p">:</span>     <span class="c1"># we use the longer way</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">File</span>          <span class="c1"># because we want to specify the &quot;format&quot; too</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">edamontology</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">format_2572</span>
</pre></div>
</div>
<p>Mixed option 2 and 3 specific example using <a class="reference external" href="#SoftwareRequirement">SoftwareRequirement</a>.<a class="reference external" href="#SoftwarePackage">packages</a>:</p>
<blockquote>
<div><p>array&lt;SoftwarePackage&gt; |
map&lt;<code class="docutils literal notranslate"><span class="pre">package</span></code>, <code class="docutils literal notranslate"><span class="pre">specs</span></code> | SoftwarePackage&gt;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hints</span><span class="p">:</span>
  <span class="n">SoftwareRequirement</span><span class="p">:</span>
    <span class="n">packages</span><span class="p">:</span>
      <span class="n">sourmash</span><span class="p">:</span> <span class="p">[</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.21105</span><span class="o">/</span><span class="n">joss</span><span class="o">.</span><span class="mi">00027</span> <span class="p">]</span>
      <span class="n">screed</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">:</span> <span class="p">[</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">dib</span><span class="o">-</span><span class="n">lab</span><span class="o">/</span><span class="n">screed</span> <span class="p">]</span>
        <span class="n">version</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">]</span>
      <span class="n">python</span><span class="p">:</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Note: The <code class="docutils literal notranslate"><span class="pre">map&lt;…&gt;</span></code> (compact) versions are optional for users, the verbose option #1 is
always allowed, but for presentation reasons option 3 and 2 may be preferred
by human readers. Consumers of CWL must support all three options.</p>
<p>The normative explanation for these variations, aimed at implementors, is in the
<a class="reference external" href="SchemaSalad.html#Identifier_maps">Schema Salad specification</a>.</p>
</div>
</div>
<div class="section" id="identifiers">
<h2>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h2>
<p>If an object contains an <code class="docutils literal notranslate"><span class="pre">id</span></code> field, that is used to uniquely identify the
object in that document.  The value of the <code class="docutils literal notranslate"><span class="pre">id</span></code> field must be unique over the
entire document.  Identifiers may be resolved relative to either the document
base and/or other identifiers following the rules are described in the
<a class="reference external" href="SchemaSalad.html#Identifier_resolution">Schema Salad specification</a>.</p>
<p>An implementation may choose to only honor references to object types for
which the <code class="docutils literal notranslate"><span class="pre">id</span></code> field is explicitly listed in this specification.</p>
</div>
<div class="section" id="document-preprocessing">
<h2>Document preprocessing<a class="headerlink" href="#document-preprocessing" title="Permalink to this headline">¶</a></h2>
<p>An implementation must resolve <a class="reference external" href="SchemaSalad.html#Import">$import</a> and
<a class="reference external" href="SchemaSalad.html#Import">$include</a> directives as described in the
<a class="reference external" href="SchemaSalad.html">Schema Salad specification</a>.</p>
<p>Another transformation defined in Schema salad is simplification of data type definitions.
Type <code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span></code> ending with <code class="docutils literal notranslate"><span class="pre">?</span></code> should be transformed to <code class="docutils literal notranslate"><span class="pre">[&lt;T&gt;,</span> <span class="pre">&quot;null&quot;]</span></code>.
Type <code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span></code> ending with <code class="docutils literal notranslate"><span class="pre">[]</span></code> should be transformed to <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;array&quot;,</span> <span class="pre">&quot;items&quot;:</span> <span class="pre">&lt;T&gt;}</span></code></p>
</div>
<div class="section" id="extensions-and-metadata">
<h2>Extensions and metadata<a class="headerlink" href="#extensions-and-metadata" title="Permalink to this headline">¶</a></h2>
<p>Input metadata (for example, a sample identifier) may be represented within
a tool or workflow using input parameters which are explicitly propagated to
output.  Future versions of this specification may define additional facilities
for working with input/output metadata.</p>
<p>Implementation extensions not required for correct execution (for example,
fields related to GUI presentation) and metadata about the tool or workflow
itself (for example, authorship for use in citations) may be provided as
additional fields on any object.  Such extensions fields must use a namespace
prefix listed in the <code class="docutils literal notranslate"><span class="pre">$namespaces</span></code> section of the document as described in the
<a class="reference external" href="SchemaSalad.html#Explicit_context">Schema Salad specification</a>.</p>
<p>It is recommended that concepts from schema.org are used whenever possible.
For the <code class="docutils literal notranslate"><span class="pre">$schema</span></code> field we recommend their RDF encoding: http://schema.org/version/latest/schema.rdf</p>
<p>Implementation extensions which modify execution semantics must be <a class="reference external" href="#Requirements_and_hints">listed in
the <code class="docutils literal notranslate"><span class="pre">requirements</span></code> field</a>.</p>
</div>
<div class="section" id="packed-documents">
<h2>Packed documents<a class="headerlink" href="#packed-documents" title="Permalink to this headline">¶</a></h2>
<p>A “packed” CWL document is one that contains multiple process objects.
This makes it possible to store and transmit a Workflow together with
the processes of each of its steps in a single file.</p>
<p>There are two methods to create packed documents: embedding and $graph.
These can be both appear in the same document.</p>
<p>“Embedding” is where the entire process object is copied into the
<code class="docutils literal notranslate"><span class="pre">run</span></code> field of a workflow step.  If the step process is a subworkflow,
it can be processed recursively to embed the processes of the
subworkflow steps, and so on.  Embedded process objects may optionally
include <code class="docutils literal notranslate"><span class="pre">id</span></code> fields.</p>
<p>A “$graph” document does not have a process object at the root.
Instead there is a <a class="reference external" href="SchemaSalad.html#Document_graph"><code class="docutils literal notranslate"><span class="pre">$graph</span></code></a> field
which consists of a list of process objects.  Each process object must
have an <code class="docutils literal notranslate"><span class="pre">id</span></code> field.  Workflow <code class="docutils literal notranslate"><span class="pre">run</span></code> fields cross-reference other
processes in the document <code class="docutils literal notranslate"><span class="pre">$graph</span></code> using the <code class="docutils literal notranslate"><span class="pre">id</span></code> of the process
object.</p>
<p>All process objects in a packed document must validate and execute as
the <code class="docutils literal notranslate"><span class="pre">cwlVersion</span></code> appearing the top level.  A <code class="docutils literal notranslate"><span class="pre">cwlVersion</span></code> field
appearing anywhere other than the top level must be ignored.</p>
<p>When executing a packed document, the reference to the document may
include a fragment identifier.  If present, the fragment identifier
specifies the <code class="docutils literal notranslate"><span class="pre">id</span></code> of the process to execute.</p>
<p>If the reference to the packed document does not include a fragment
identifier, the runner must choose the top-level process object as the
entry point.  If there is no top-level process object (as in the case
of <code class="docutils literal notranslate"><span class="pre">$graph</span></code>) then the runner must choose the process object with an id
of <code class="docutils literal notranslate"><span class="pre">#main</span></code>.  If there is no <code class="docutils literal notranslate"><span class="pre">#main</span></code> object, the runner must return an
error.</p>
</div>
</div>
<div class="section" id="execution-model">
<h1>Execution model<a class="headerlink" href="#execution-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="execution-concepts">
<h2>Execution concepts<a class="headerlink" href="#execution-concepts" title="Permalink to this headline">¶</a></h2>
<p>A <strong>parameter</strong> is a named symbolic input or output of process, with
an associated datatype or schema.  During execution, values are
assigned to parameters to make the input object or output object used
for concrete process invocation.</p>
<p>A <strong>CommandLineTool</strong> is a process characterized by the execution of a
standalone, non-interactive program which is invoked on some input,
produces output, and then terminates.</p>
<p>A <strong>workflow</strong> is a process characterized by multiple subprocess steps,
where step outputs are connected to the inputs of downstream steps to
form a directed acylic graph, and independent steps may run concurrently.</p>
<p>A <strong>runtime environment</strong> is the actual hardware and software environment when
executing a command line tool.  It includes, but is not limited to, the
hardware architecture, hardware resources, operating system, software runtime
(if applicable, such as the specific Python interpreter or the specific Java
virtual machine), libraries, modules, packages, utilities, and data files
required to run the tool.</p>
<p>A <strong>workflow platform</strong> is a specific hardware and software implementation
capable of interpreting CWL documents and executing the processes specified by
the document.  The responsibilities of the workflow platform may include
scheduling process invocation, setting up the necessary runtime environment,
making input data available, invoking the tool process, and collecting output.</p>
<p>A <strong>data link</strong> is a connection from a “Source” parameter to a “Sink”
parameter.  A data link expresses that when a value becomes available
for the source parameter, that value should be copied to the “sink”
parameter.  Reflecting the direction of data flow, a data link is
described as “outgoing” from the source and “inbound” to the sink.</p>
<p>A workflow platform may choose to only implement the Command Line Tool
Description part of the CWL specification.</p>
<p>It is intended that the workflow platform has broad leeway outside of this
specification to optimize use of computing resources and enforce policies
not covered by this specification.  Some areas that are currently out of
scope for CWL specification but may be handled by a specific workflow
platform include:</p>
<ul class="simple">
<li><p>Data security and permissions</p></li>
<li><p>Scheduling tool invocations on remote cluster or cloud compute nodes.</p></li>
<li><p>Using virtual machines or operating system containers to manage the runtime
(except as described in <a class="reference external" href="CommandLineTool.html#DockerRequirement">DockerRequirement</a>).</p></li>
<li><p>Using remote or distributed file systems to manage input and output files.</p></li>
<li><p>Transforming file paths.</p></li>
<li><p>Pausing, resuming or checkpointing processes or workflows.</p></li>
</ul>
<p>Conforming CWL processes must not assume anything about the runtime
environment or workflow platform unless explicitly declared though the use
of <a class="reference external" href="#Requirements_and_hints">process requirements</a>.</p>
</div>
<div class="section" id="generic-execution-process">
<h2>Generic execution process<a class="headerlink" href="#generic-execution-process" title="Permalink to this headline">¶</a></h2>
<p>The generic execution sequence of a CWL process (including workflows
and command line line tools) is as follows.  Processes are
modeled as functions that consume an input object and produce an
output object.</p>
<ol class="simple">
<li><p>Load input object.</p></li>
<li><p>Load, process and validate a CWL document, yielding one or more process objects.
The <a class="reference external" href="SchemaSalad.html#Explicit_context"><code class="docutils literal notranslate"><span class="pre">$namespaces</span></code></a> present in the CWL document
are also used when validating and processing the input object.</p></li>
<li><p>If there are multiple process objects (due to <a class="reference external" href="SchemaSalad.html#Document_graph"><code class="docutils literal notranslate"><span class="pre">$graph</span></code></a>)
and which process object to start with is not specified in the input object (via
a <a class="reference external" href="#Executing_CWL_documents_as_scripts"><code class="docutils literal notranslate"><span class="pre">cwl:tool</span></code></a> entry) or by any other means
(like a URL fragment) then choose the process with the <code class="docutils literal notranslate"><span class="pre">id</span></code> of “#main” or “main”.</p></li>
<li><p>Validate the input object against the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> schema for the process.</p></li>
<li><p>Validate process requirements are met.</p></li>
<li><p>Perform any further setup required by the specific process type.</p></li>
<li><p>Execute the process.</p></li>
<li><p>Capture results of process execution into the output object.</p></li>
<li><p>Validate the output object against the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> schema for the process.</p></li>
<li><p>Report the output object to the process caller.</p></li>
</ol>
</div>
<div class="section" id="requirements-and-hints">
<h2>Requirements and hints<a class="headerlink" href="#requirements-and-hints" title="Permalink to this headline">¶</a></h2>
<p>A <strong>process requirement</strong> modifies the semantics or runtime
environment of a process.  If an implementation cannot satisfy all
requirements, or a requirement is listed which is not recognized by the
implementation, it is a fatal error and the implementation must not attempt
to run the process, unless overridden at user option.</p>
<p>A <strong>hint</strong> is similar to a requirement; however, it is not an error if an
implementation cannot satisfy all hints.  The implementation may report a
warning if a hint cannot be satisfied.</p>
<p>Optionally, implementations may allow requirements to be specified in the input
object document as an array of requirements under the field name
<code class="docutils literal notranslate"><span class="pre">cwl:requirements</span></code>. If implementations allow this, then such requirements
should be combined with any requirements present in the corresponding Process
as if they were specified there.</p>
<p>Requirements specified in a parent Workflow are inherited by step processes
if they are valid for that step. If the substep is a CommandLineTool
only the <code class="docutils literal notranslate"><span class="pre">InlineJavascriptRequirement</span></code>, <code class="docutils literal notranslate"><span class="pre">SchemaDefRequirement</span></code>, <code class="docutils literal notranslate"><span class="pre">DockerRequirement</span></code>,
<code class="docutils literal notranslate"><span class="pre">SoftwareRequirement</span></code>, <code class="docutils literal notranslate"><span class="pre">InitialWorkDirRequirement</span></code>, <code class="docutils literal notranslate"><span class="pre">EnvVarRequirement</span></code>,
<code class="docutils literal notranslate"><span class="pre">ShellCommandRequirement</span></code>, <code class="docutils literal notranslate"><span class="pre">ResourceRequirement</span></code> are valid.</p>
<p><em>As good practice, it is best to have process requirements be self-contained,
such that each process can run successfully by itself.</em></p>
<p>If the same process requirement appears at different levels of the
workflow, the most specific instance of the requirement is used, that is,
an entry in <code class="docutils literal notranslate"><span class="pre">requirements</span></code> on a process implementation such as
CommandLineTool will take precedence over an entry in <code class="docutils literal notranslate"><span class="pre">requirements</span></code>
specified in a workflow step, and an entry in <code class="docutils literal notranslate"><span class="pre">requirements</span></code> on a workflow
step takes precedence over the workflow.  Entries in <code class="docutils literal notranslate"><span class="pre">hints</span></code> are resolved
the same way.</p>
<p>Requirements override hints.  If a process implementation provides a
process requirement in <code class="docutils literal notranslate"><span class="pre">hints</span></code> which is also provided in <code class="docutils literal notranslate"><span class="pre">requirements</span></code> by
an enclosing workflow or workflow step, the enclosing <code class="docutils literal notranslate"><span class="pre">requirements</span></code> takes
precedence.</p>
</div>
<div class="section" id="parameter-references">
<h2>Parameter references<a class="headerlink" href="#parameter-references" title="Permalink to this headline">¶</a></h2>
<p>Parameter references are denoted by the syntax <code class="docutils literal notranslate"><span class="pre">$(...)</span></code> and may be used in any
field permitting the pseudo-type <code class="docutils literal notranslate"><span class="pre">Expression</span></code>, as specified by this document.
Conforming implementations must support parameter references.  Parameter
references use the following subset of
<a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/">Javascript/ECMAScript 5.1</a>
syntax, but they are designed to not require a Javascript engine for evaluation.</p>
<p>In the following <a class="reference external" href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">BNF grammar</a>,
character classes and grammar rules are denoted in ‘{}’, ‘-‘ denotes
exclusion from a character class, ‘(())’ denotes grouping, ‘|’ denotes
alternates, trailing ‘*’ denotes zero or more repeats, ‘+’ denote one
or more repeats, and all other characters are literal values.</p>
<p>
<table class="table">
<tr><td>symbol::             </td><td>{Unicode alphanumeric}+</td></tr>
<tr><td>singleq::            </td><td>[' (( {character - { | \ ' \} } ))* ']</td></tr>
<tr><td>doubleq::            </td><td>[" (( {character - { | \ " \} } ))* "]</td></tr>
<tr><td>index::              </td><td>[ {decimal digit}+ ]</td></tr>
<tr><td>segment::            </td><td>. {symbol} | {singleq} | {doubleq} | {index}</td></tr>
<tr><td>parameter reference::</td><td>$( {symbol} {segment}*)</td></tr>
</table>
</p><p>Use the following algorithm to resolve a parameter reference:</p>
<ol class="simple">
<li><p>Match the leading symbol as the key</p></li>
<li><p>Look up the key in the parameter context (described below) to get the current value.
It is an error if the key is not found in the parameter context.</p></li>
<li><p>If there are no subsequent segments, terminate and return current value</p></li>
<li><p>Else, match the next segment</p></li>
<li><p>Extract the symbol, string, or index from the segment as the key</p></li>
<li><p>Look up the key in current value and assign as new current value.  If
the key is a symbol or string, the current value must be an object.
If the key is an index, the current value must be an array or string.
It is an error if the key does not match the required type, or the key is not found or out
of range.</p></li>
<li><p>Repeat steps 3-6</p></li>
</ol>
<p>The root namespace is the parameter context.  The following parameters must
be provided:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: The input object to the current Process.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self</span></code>: A context-specific value.  The contextual values for ‘self’ are
documented for specific fields elsewhere in this specification.  If
a contextual value of ‘self’ is not documented for a field, it
must be ‘null’.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime</span></code>: An object containing configuration details.  Specific to the
process type.  An implementation may provide
opaque strings for any or all fields of <code class="docutils literal notranslate"><span class="pre">runtime</span></code>.  These must be
filled in by the platform after processing the Tool but before actual
execution.  Parameter references and expressions may only use the
literal string value of the field and must not perform computation on
the contents, except where noted otherwise.</p></li>
</ul>
<p>If the value of a field has no leading or trailing non-whitespace
characters around a parameter reference, the effective value of the field
becomes the value of the referenced parameter, preserving the return type.</p>
<div class="section" id="string-interpolation">
<h3>String interpolation<a class="headerlink" href="#string-interpolation" title="Permalink to this headline">¶</a></h3>
<p>If the value of a field has non-whitespace leading or trailing characters
around a parameter reference, it is subject to string interpolation.  The
effective value of the field is a string containing the leading characters,
followed by the string value of the parameter reference, followed by the
trailing characters.  The string value of the parameter reference is its
textual JSON representation with the following rules:</p>
<ul class="simple">
<li><p>Strings are replaced the literal text of the string, any escaped
characters replaced by the literal characters they represent, and
there are no leading or trailing quotes.</p></li>
<li><p>Objects entries are sorted by key</p></li>
</ul>
<p>Multiple parameter references may appear in a single field.  This case
must be treated as a string interpolation.  After interpolating the first
parameter reference, interpolation must be recursively applied to the
trailing characters to yield the final string value.</p>
<p>When text embedded in a CWL file represents code for another
programming language, the use of <code class="docutils literal notranslate"><span class="pre">$(...)</span></code> (and <code class="docutils literal notranslate"><span class="pre">${...}</span></code> in the case of
expressions) may conflict with the syntax of that language.  For
example, when writing shell scripts, <code class="docutils literal notranslate"><span class="pre">$(...)</span></code> is used to execute a
command in a subshell and replace a portion of the command line with
the standard output of that command.</p>
<p>The following escaping rules apply.  The scanner makes a single pass
from start to end with 3-character lookahead.  After performing a
replacement scanning resumes at the next character following the
replaced substring.</p>
<ol class="simple">
<li><p>The substrings <code class="docutils literal notranslate"><span class="pre">\$(</span></code> and <code class="docutils literal notranslate"><span class="pre">\${</span></code> are replaced by <code class="docutils literal notranslate"><span class="pre">$(</span></code> and <code class="docutils literal notranslate"><span class="pre">${</span></code>
respectively.  No parameter or expression evaluation
interpolation occurs.</p></li>
<li><p>A double backslash <code class="docutils literal notranslate"><span class="pre">\\</span></code> is replaced by a single backslash <code class="docutils literal notranslate"><span class="pre">\</span></code>.</p></li>
<li><p>A substring starting with a backslash that does not match one of
the previous rules is left unchanged.</p></li>
</ol>
</div>
</div>
<div class="section" id="expressions-optional">
<h2>Expressions (Optional)<a class="headerlink" href="#expressions-optional" title="Permalink to this headline">¶</a></h2>
<p>An expression is a fragment of <a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/">Javascript/ECMAScript
5.1</a> code evaluated by the
workflow platform to affect the inputs, outputs, or
behavior of a process.  In the generic execution sequence, expressions may
be evaluated during step 5 (process setup), step 6 (execute process),
and/or step 7 (capture output).  Expressions are distinct from regular
processes in that they are intended to modify the behavior of the workflow
itself rather than perform the primary work of the workflow.</p>
<p>Expressions in CWL are an optional feature and are not required to be
implemented by all consumers of CWL documents. They should be used sparingly,
when there is no other way to achieve the desired outcome. Excessive use of
expressions may be a signal that other refactoring of the tools or workflows
would benefit the author, runtime, and users of the CWL document in question.</p>
<p>To declare the use of expressions, the document must include the process
requirement <code class="docutils literal notranslate"><span class="pre">InlineJavascriptRequirement</span></code>.  Expressions may be used in any
field permitting the pseudo-type <code class="docutils literal notranslate"><span class="pre">Expression</span></code>, as specified by this
document.</p>
<p>Expressions are denoted by the syntax <code class="docutils literal notranslate"><span class="pre">$(...)</span></code> or <code class="docutils literal notranslate"><span class="pre">${...}</span></code>.  A code
fragment wrapped in the <code class="docutils literal notranslate"><span class="pre">$(...)</span></code> syntax must be evaluated as a
<a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/#sec-11">ECMAScript expression</a>.  A
code fragment wrapped in the <code class="docutils literal notranslate"><span class="pre">${...}</span></code> syntax must be evaluated as a
<a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/#sec-13">ECMAScript function body</a>
for an anonymous, zero-argument function.  Expressions must return a valid JSON
data type: one of null, string, number, boolean, array, object. Other return
values must result in a <code class="docutils literal notranslate"><span class="pre">permanentFailure</span></code>. Implementations must permit any
syntactically valid Javascript and account for nesting of parenthesis or braces
and that strings that may contain parenthesis or braces when scanning for
expressions.</p>
<p>The runtime must include any code defined in the <a class="reference external" href="#InlineJavascriptRequirement">“expressionLib” field of
InlineJavascriptRequirement</a> prior to
executing the actual expression.</p>
<p>Before executing the expression, the runtime must initialize as global
variables the fields of the parameter context described above.</p>
<p>The effective value of the field after expression evaluation follows the
same rules as parameter references discussed above.  Multiple expressions
may appear in a single field.</p>
<p>Expressions must be evaluated in an isolated context (a “sandbox”) which
permits no side effects to leak outside the context.  Expressions also must
be evaluated in <a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/#sec-4.2.2">Javascript strict mode</a>.</p>
<p>The order in which expressions are evaluated is undefined except where
otherwise noted in this document.</p>
<p>An implementation may choose to implement parameter references by
evaluating as a Javascript expression.  The results of evaluating
parameter references must be identical whether implemented by Javascript
evaluation or some other means.</p>
<p>Implementations may apply other limits, such as process isolation, timeouts,
and operating system containers/jails to minimize the security risks associated
with running untrusted code embedded in a CWL document.</p>
<p>Javascript exceptions thrown from a CWL expression must result in a
<code class="docutils literal notranslate"><span class="pre">permanentFailure</span></code> of the CWL process.</p>
</div>
<div class="section" id="executing-cwl-documents-as-scripts">
<h2>Executing CWL documents as scripts<a class="headerlink" href="#executing-cwl-documents-as-scripts" title="Permalink to this headline">¶</a></h2>
<p>By convention, a CWL document may begin with <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">cwl-runner</span></code>
and be marked as executable (the POSIX “+x” permission bits) to enable it
to be executed directly.  A workflow platform may support this mode of
operation; if so, it must provide <code class="docutils literal notranslate"><span class="pre">cwl-runner</span></code> as an alias for the
platform’s CWL implementation.</p>
<p>A CWL input object document may similarly begin with <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">cwl-runner</span></code> and be marked as executable.  In this case, the input object
must include the field <code class="docutils literal notranslate"><span class="pre">cwl:tool</span></code> supplying an IRI to the default CWL
document that should be executed using the fields of the input object as
input parameters.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cwl-runner</span></code> interface is required for conformance testing and is
documented in <a class="reference external" href="cwl-runner.cwl">cwl-runner.cwl</a>.</p>
</div>
<div class="section" id="discovering-cwl-documents-on-a-local-filesystem">
<h2>Discovering CWL documents on a local filesystem<a class="headerlink" href="#discovering-cwl-documents-on-a-local-filesystem" title="Permalink to this headline">¶</a></h2>
<p>To discover CWL documents look in the following locations:</p>
<p>For each value in the <code class="docutils literal notranslate"><span class="pre">XDG_DATA_DIRS</span></code> environment variable (which is a <code class="docutils literal notranslate"><span class="pre">:</span></code> colon
separated list), check the <code class="docutils literal notranslate"><span class="pre">./commonwl</span></code> subdirectory. If <code class="docutils literal notranslate"><span class="pre">XDG_DATA_DIRS</span></code> is
unset or empty, then check using the default value for <code class="docutils literal notranslate"><span class="pre">XDG_DATA_DIRS</span></code>:
<code class="docutils literal notranslate"><span class="pre">/usr/local/share/:/usr/share/</span></code> (That is to say, check <code class="docutils literal notranslate"><span class="pre">/usr/share/commonwl/</span></code>
and <code class="docutils literal notranslate"><span class="pre">/usr/local/share/commonwl/</span></code>)</p>
<p>Then check <code class="docutils literal notranslate"><span class="pre">$XDG_DATA_HOME/commonwl/</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">XDG_DATA_HOME</span></code> environment variable is unset, its default value is
<code class="docutils literal notranslate"><span class="pre">$HOME/.local/share</span></code> (That is to say, check <code class="docutils literal notranslate"><span class="pre">$HOME/.local/share/commonwl</span></code>)</p>
<p><code class="docutils literal notranslate"><span class="pre">$XDG_DATA_HOME</span></code> and <code class="docutils literal notranslate"><span class="pre">$XDG_DATA_DIRS</span></code> are from the <a class="reference external" href="http://standards.freedesktop.org/basedir-spec/basedir-spec-0.6.html">XDG Base Directory
Specification</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../index.html">NSAPH Data Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../README.html">NSAPH Data Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../doc/Datamodels.html">Data Modelling for NSAPH Data Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../doc/Medicaid.html">Handling Medicaid data</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Harvard University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../../../../_sources/.nsaph/lib/python3.8/site-packages/cwltool/schemas/v1.2.0-dev5/concepts.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>