
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Running a Command &#8212; NSAPH Data Platform 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/sphinx_paramlinks.css" />
    <script data-url_root="../../../../../../../" id="documentation_options" src="../../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="running-a-command">
<h1>Running a Command<a class="headerlink" href="#running-a-command" title="Permalink to this headline">¶</a></h1>
<p>To accommodate the enormous variety in syntax and semantics for input, runtime
environment, invocation, and output of arbitrary programs, a CommandLineTool
defines an “input binding” that describes how to translate abstract input
parameters to an concrete program invocation, and an “output binding” that
describes how to generate output parameters from program output.</p>
<div class="section" id="input-binding">
<h2>Input binding<a class="headerlink" href="#input-binding" title="Permalink to this headline">¶</a></h2>
<p>The tool command line is built by applying command line bindings to the
input object.  Bindings are listed either as part of an <a class="reference external" href="#CommandInputParameter">input
parameter</a> using the <code class="docutils literal notranslate"><span class="pre">inputBinding</span></code> field, or
separately using the <code class="docutils literal notranslate"><span class="pre">arguments</span></code> field of the CommandLineTool.</p>
<p>The algorithm to build the command line is as follows.  In this algorithm,
the sort key is a list consisting of one or more numeric or string
elements.  Strings are sorted lexicographically based on UTF-8 encoding.</p>
<ol class="simple">
<li><p>Collect <code class="docutils literal notranslate"><span class="pre">CommandLineBinding</span></code> objects from <code class="docutils literal notranslate"><span class="pre">arguments</span></code>.  Assign a sorting
key <code class="docutils literal notranslate"><span class="pre">[position,</span> <span class="pre">i]</span></code> where <code class="docutils literal notranslate"><span class="pre">position</span></code> is
<a class="reference external" href="#CommandLineBinding"><code class="docutils literal notranslate"><span class="pre">CommandLineBinding.position</span></code></a> and <code class="docutils literal notranslate"><span class="pre">i</span></code>
is the index in the <code class="docutils literal notranslate"><span class="pre">arguments</span></code> list.</p></li>
<li><p>Collect <code class="docutils literal notranslate"><span class="pre">CommandLineBinding</span></code> objects from the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> schema and
associate them with values from the input object.  Where the input type
is a record, array, or map, recursively walk the schema and input object,
collecting nested <code class="docutils literal notranslate"><span class="pre">CommandLineBinding</span></code> objects and associating them with
values from the input object.</p></li>
<li><p>Create a sorting key by taking the value of the <code class="docutils literal notranslate"><span class="pre">position</span></code> field at
each level leading to each leaf binding object.  If <code class="docutils literal notranslate"><span class="pre">position</span></code> is not
specified, it is not added to the sorting key.  For bindings on arrays
and maps, the sorting key must include the array index or map key
following the position.  If and only if two bindings have the same sort
key, the tie must be broken using the ordering of the field or parameter
name immediately containing the leaf binding.</p></li>
<li><p>Sort elements using the assigned sorting keys.  Numeric entries sort
before strings.</p></li>
<li><p>In the sorted order, apply the rules defined in
<a class="reference external" href="#CommandLineBinding"><code class="docutils literal notranslate"><span class="pre">CommandLineBinding</span></code></a> to convert bindings to actual
command line elements.</p></li>
<li><p>Insert elements from <code class="docutils literal notranslate"><span class="pre">baseCommand</span></code> at the beginning of the command
line.</p></li>
</ol>
</div>
<div class="section" id="runtime-environment">
<h2>Runtime environment<a class="headerlink" href="#runtime-environment" title="Permalink to this headline">¶</a></h2>
<p>All files listed in the input object must be made available in the runtime
environment.  The implementation may use a shared or distributed file
system or transfer files via explicit download to the host.  Implementations
may choose not to provide access to files not explicitly specified in the input
object or process requirements.</p>
<p>Output files produced by tool execution must be written to the
<strong>designated output directory</strong>.  The initial current working
directory when executing the tool must be the designated output
directory.  The designated output directory should be empty, except
for files or directories specified using
<a class="reference external" href="InitialWorkDirRequirement">InitialWorkDirRequirement</a>.</p>
<p>Files may also be written to the <strong>designated temporary directory</strong>.  This
directory must be isolated and not shared with other processes.  Any files
written to the designated temporary directory may be automatically deleted by
the workflow platform immediately after the tool terminates.</p>
<p>For compatibility, files may be written to the <strong>system temporary directory</strong>
which must be located at <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>.  Because the system temporary directory may be
shared with other processes on the system, files placed in the system temporary
directory are not guaranteed to be deleted automatically.  A tool
must not use the system temporary directory as a backchannel communication with
other tools.  It is valid for the system temporary directory to be the same as
the designated temporary directory.</p>
<p>When executing the tool, the tool must execute in a new, empty environment
with only the environment variables described below; the child process must
not inherit environment variables from the parent process except as
specified or at user option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HOME</span></code> must be set to the designated output directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> must be set to the designated temporary directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PATH</span></code> may be inherited from the parent process, except when run in a
container that provides its own <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p></li>
<li><p>Variables defined by <a class="reference external" href="#EnvVarRequirement">EnvVarRequirement</a></p></li>
<li><p>The default environment of the container, such as when using
<a class="reference external" href="#DockerRequirement">DockerRequirement</a></p></li>
</ul>
<p>An implementation may forbid the tool from writing to any location in the
runtime environment file system other than the designated temporary directory,
system temporary directory, and designated output directory.  An implementation
may provide read-only input files, and disallow in-place update of input files.
The designated temporary directory, system temporary directory and designated
output directory may each reside on different mount points on different file
systems.</p>
<p>An implementation may forbid the tool from directly accessing network
resources.  Correct tools must not assume any network access.  Future versions
of the specification may incorporate optional process requirements that
describe the networking needs of a tool.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">runtime</span></code> section available in <a class="reference external" href="#Parameter_references">parameter references</a>
and <a class="reference external" href="#Expressions">expressions</a> contains the following fields.  As noted
earlier, an implementation may perform deferred resolution of runtime fields by providing
opaque strings for any or all of the following fields; parameter references
and expressions may only use the literal string value of the field and must
not perform computation on the contents.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.outdir</span></code>: an absolute path to the designated output directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.tmpdir</span></code>: an absolute path to the designated temporary directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.cores</span></code>:  number of CPU cores reserved for the tool process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.ram</span></code>:    amount of RAM in mebibytes (2**20) reserved for the tool process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.outdirSize</span></code>: reserved storage space available in the designated output directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime.tmpdirSize</span></code>: reserved storage space available in the designated temporary directory</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">cores</span></code>, <code class="docutils literal notranslate"><span class="pre">ram</span></code>, <code class="docutils literal notranslate"><span class="pre">outdirSize</span></code> and <code class="docutils literal notranslate"><span class="pre">tmpdirSize</span></code>, if an implementation can’t
provide the actual number of reserved cores during the expression evaluation time,
it should report back the minimal requested amount.</p>
<p>See <a class="reference external" href="#ResourceRequirement">ResourceRequirement</a> for details on how to
describe the hardware resources required by a tool.</p>
<p>The standard input stream and standard output stream may be redirected as
described in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> and <code class="docutils literal notranslate"><span class="pre">stdout</span></code> fields.</p>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<p>Once the command line is built and the runtime environment is created, the
actual tool is executed.</p>
<p>The standard error stream and standard output stream (unless redirected by
setting <code class="docutils literal notranslate"><span class="pre">stdout</span></code> or <code class="docutils literal notranslate"><span class="pre">stderr</span></code>) may be captured by platform logging facilities
for storage and reporting.</p>
<p>Tools may be multithreaded or spawn child processes; however, when the
parent process exits, the tool is considered finished regardless of whether
any detached child processes are still running.  Tools must not require any
kind of console, GUI, or web based user interaction in order to start and
run to completion.</p>
<p>The exit code of the process indicates if the process completed
successfully.  By convention, an exit code of zero is treated as success
and non-zero exit codes are treated as failure.  This may be customized by
providing the fields <code class="docutils literal notranslate"><span class="pre">successCodes</span></code>, <code class="docutils literal notranslate"><span class="pre">temporaryFailCodes</span></code>, and
<code class="docutils literal notranslate"><span class="pre">permanentFailCodes</span></code>.  An implementation may choose to default unspecified
non-zero exit codes to either <code class="docutils literal notranslate"><span class="pre">temporaryFailure</span></code> or <code class="docutils literal notranslate"><span class="pre">permanentFailure</span></code>.</p>
<p>The exit code of the process is available to expressions in
<code class="docutils literal notranslate"><span class="pre">outputEval</span></code> as <code class="docutils literal notranslate"><span class="pre">runtime.exitCode</span></code>.</p>
</div>
<div class="section" id="output-binding">
<h2>Output binding<a class="headerlink" href="#output-binding" title="Permalink to this headline">¶</a></h2>
<p>If the output directory contains a file named “cwl.output.json”, that file
must be loaded and used as the output object.  Otherwise, the output object
must be generated by walking the parameters listed in <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and
applying output bindings to the tool output.  Output bindings are
associated with output parameters using the <code class="docutils literal notranslate"><span class="pre">outputBinding</span></code> field.  See
<a class="reference external" href="#CommandOutputBinding"><code class="docutils literal notranslate"><span class="pre">CommandOutputBinding</span></code></a> for details.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../index.html">NSAPH Data Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../README.html">NSAPH Data Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../doc/Datamodels.html">Data Modelling for NSAPH Data Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../doc/Medicaid.html">Handling Medicaid data</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Harvard University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../../../../_sources/.nsaph/lib/python3.8/site-packages/cwltool/schemas/v1.1.0-dev1/invocation.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>