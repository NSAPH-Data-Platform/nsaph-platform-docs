<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with the get_census Package &mdash; NSAPH Data Platform 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx_paramlinks.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="get_census Census Variable File Structure" href="census_yaml.html" />
    <link rel="prev" title="Welcome to get_census’s documentation!" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NSAPH Data Platform
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with the <code class="docutils literal notranslate"><span class="pre">get_census</span></code> Package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-set-up">Environment Set-up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-command-line-interface">Running the Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-python-workflow">Main Python Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shapefile-downloads">Shapefile Downloads</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="census_yaml.html"><code class="docutils literal notranslate"><span class="pre">get_census</span></code> Census Variable File Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="assemble_data.html">DataPlan: Main Class For Assembling a Census Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="census_info.html">Census Metadata Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Functions for Requesting Data from the Census API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cached_data.html">Stored Data Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="tigerweb.html">Query Area and Download Shapefiles</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NSAPH Data Platform</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Working with the <code class="docutils literal notranslate"><span class="pre">get_census</span></code> Package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/source/start_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-the-get-census-package">
<h1>Working with the <code class="docutils literal notranslate"><span class="pre">get_census</span></code> Package<a class="headerlink" href="#working-with-the-get-census-package" title="Permalink to this headline"></a></h1>
<p>The Get Census package provides an interface with US Census Data,
including the main API, some functionality for working with the TigerWeb API,
and the FTP site for Tiger Shapefile Downloads. This package also includes a command
line interface to enable quick running of standard workflows.</p>
<section id="environment-set-up">
<h2>Environment Set-up<a class="headerlink" href="#environment-set-up" title="Permalink to this headline"></a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">get_census</span></code> git repostory, we have included a yaml
file (<code class="docutils literal notranslate"><span class="pre">get_census_env.yml</span></code>) that can be used to create a <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment
with the needed dependencies. In addition to this, the <code class="docutils literal notranslate"><span class="pre">nsaph_utils</span></code> package
and the <code class="docutils literal notranslate"><span class="pre">get_census</span></code> packages will need to be installed from source using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.
Cloning the repository and running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">&lt;path</span> <span class="pre">to</span> <span class="pre">package&gt;</span></code> will handle
that installation.</p>
<p>Finally, in order to interact with the US Census API at scale, you’ll a Census API
key. You can get one <a class="reference external" href="https://api.census.gov/data/key_signup.html">here</a>. Once
you have your key, you’ll need to add it to your environment. You can either do that
through <code class="docutils literal notranslate"><span class="pre">conda</span></code> (<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">config</span> <span class="pre">vars</span> <span class="pre">set</span> <span class="pre">GET_CENSUS_API_KEY=&lt;your</span> <span class="pre">key&gt;</span></code>), setting
the key directly in your <code class="docutils literal notranslate"><span class="pre">.rc</span></code> file, or by using the <code class="docutils literal notranslate"><span class="pre">get_census.set_api_key</span></code> function
(this only affects your current session, and isn’t permanent).</p>
</section>
<section id="running-the-command-line-interface">
<h2>Running the Command Line Interface<a class="headerlink" href="#running-the-command-line-interface" title="Permalink to this headline"></a></h2>
<p>When <code class="docutils literal notranslate"><span class="pre">get_census</span></code> is installed, a command line utility (also named <code class="docutils literal notranslate"><span class="pre">get_census</span></code>)
is automatically made available in your environment. Documentation on the CLI can be
accessed by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_census</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>An example run would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_census</span> <span class="o">--</span><span class="n">var_file</span> <span class="n">census_vars</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">y</span> <span class="mi">2009</span><span class="p">:</span><span class="mi">2019</span> <span class="o">--</span><span class="n">geom</span> <span class="n">tract</span> <span class="o">-</span><span class="n">d</span> <span class="n">population</span> <span class="o">-</span><span class="n">i</span> <span class="n">x</span> <span class="o">--</span><span class="n">out</span> <span class="o">../</span><span class="n">data</span><span class="o">/</span><span class="n">census_tract_2009_2019</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>This would take the variable definitions in <code class="docutils literal notranslate"><span class="pre">census_vars.yml</span></code> (<code class="docutils literal notranslate"><span class="pre">--var_file</span> <span class="pre">census_vars.yml</span></code>)
, process them from the API for census tracts (<code class="docutils literal notranslate"><span class="pre">--geom</span> <span class="pre">tract</span></code>) for 2009 - 2019 (<code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">2009:2019</span></code>),
calculate density per square mile for the “population” variable (<code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">population</span></code>),
would not interpolate (<code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">x</span></code>), and would write the created data frame to the
path specified by <code class="docutils literal notranslate"><span class="pre">--out</span></code>.</p>
</section>
<section id="main-python-workflow">
<h2>Main Python Workflow<a class="headerlink" href="#main-python-workflow" title="Permalink to this headline"></a></h2>
<p>All main functionality for this package is contained within the <cite>DataPlan</cite> object.
For detailed documentation on its methods, please see <a class="reference internal" href="assemble_data.html"><span class="doc">DataPlan: Main Class For Assembling a Census Plan</span></a>.</p>
<p>The general workflow is as follows:</p>
<ul>
<li><p>Create your DataPlan Object (this one is for county data for 2000-2019):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span> <span class="o">=</span> <span class="n">get_census</span><span class="o">.</span><span class="n">DataPlan</span><span class="p">(</span><span class="s2">&quot;census_vars.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;county&quot;</span><span class="p">,</span> <span class="n">years</span> <span class="o">=</span> <span class="n">get_census</span><span class="o">.</span><span class="n">census_years</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2019</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<p>On creation, the object creates a plan for a series of API queries to calculate the desired
variables based on the passed in yaml file. Details on how to structure that yaml file can be found in
<a class="reference internal" href="census_yaml.html"><span class="doc">get_census Census Variable File Structure</span></a>.</p>
<ul>
<li><p>Make the API calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span><span class="o">.</span><span class="n">assemble_data</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>This tells the DataPlan object to start making and combing all the specified API calls.</p>
<p>After this completes, the data is usable for analysis. However, it will only contain data for
years that are available through the US census. It also will not have any densities, or other
columns. Despite this, if you are interpolating or calculating densities, it is still
best practice for reproducuibility to save a copy of your data at this point. You can do that
by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="s2">&quot;census_uninterpolated.csv&quot;</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>After this, we can begin interpolation.</p>
<ul>
<li><p>Interpolate the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">min_year</span> <span class="o">=</span> <span class="mi">1999</span><span class="p">,</span> <span class="n">max_year</span> <span class="o">=</span> <span class="mi">2019</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>This will interpolate missing data using a weighted moving average model missing data for each
variable, for each geographic unit, for each year in the dataset. Since ACS data/Decennial data
is available for counties in 2000, and in 2009 onward, this will create data for 1999, and 2001-2008.
More information on the interpolation methods can be seen in the <code class="docutils literal notranslate"><span class="pre">nsaph_utils</span></code> package documentation.</p>
<ul>
<li><p>Calculate Densities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span><span class="o">.</span><span class="n">calculate_densities</span><span class="p">([</span><span class="s2">&quot;population&quot;</span><span class="p">],</span> <span class="n">sq_mi</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>This will calculate the density per square mile of the variable population within the
assembled data set. This can take some time to run, as it needs to get the area of each geographic
unit from the tigerweb API. Also note that due to limited data availability, the area may not
100% correspond to the area of the year in question.</p>
<ul>
<li><p>Write the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plan</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="s2">&quot;census_interpolated.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Your data set is now complete and written to disk.</p>
</section>
<section id="shapefile-downloads">
<h2>Shapefile Downloads<a class="headerlink" href="#shapefile-downloads" title="Permalink to this headline"></a></h2>
<p>In addition to the general processing workflow, the package also includes
a function for downloading Census geography shape files. Please see <a class="reference internal" href="tigerweb.html"><span class="doc">Query Area and Download Shapefiles</span></a>
for documentation on the functions interacting with the Census geographic resources.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="Welcome to get_census’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="census_yaml.html" class="btn btn-neutral float-right" title="get_census Census Variable File Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Harvard University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>